<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.springboot.myapp.eds.erp.controller.system.systemShaMapper">

    <select id="selectShaList" resultType="com.springboot.myapp.eds.erp.vo.system.systemShaListVO">
        SELECT /* selectShaList */
            corpCd
            ,groupNo
            ,groupCd
            ,groupDivi
            ,groupCdNm
            ,groupCdExp
            ,groupOrder
            ,useYn
        FROM TB_SYSTEM_SHA_LIST
        WHERE corpCd = #{corpCd}
        <if test="groupCd != null and !groupCd.equals('')">
            AND groupCd like '%' #{groupCd} '%'
        </if>
        <if test="groupCdNm != null and !groupCdNm.equals('')">
            AND groupCdNm like '%' #{groupCdNm} '%'
        </if>
        <if test="groupDivi != null and !groupDivi.equals('')">
            AND groupDivi = #{groupDivi}
        </if>
        <if test="useYn != null and !useYn.equals('')">
            AND useYn = #{useYn}
        </if>
        ORDER BY groupDivi, groupOrder
    </select>

    <select id="selectShaDet"  resultType="com.springboot.myapp.eds.erp.vo.system.systemShaDetVO">
        SELECT /* selectShaDet */
            corpCd
            ,groupNo
            ,commCdNo
            ,commCd
            ,commCdNm
            ,commCdExp
            ,reserveVal1
            ,reserveVal2
            ,reserveVal3
            ,commCdOrder
            ,useYn
        FROM TB_SYSTEM_SHA_DET
        WHERE corpCd = #{corpCd}
        AND groupNo = #{groupNo}
        ORDER BY commCdOrder
    </select>

    <insert id="insertShaList" parameterType="hashMap">
        INSERT INTO /* insertShaList */
        TB_SYSTEM_SHA_LIST(
             corpCd
            ,groupNo
            ,groupCd
            ,groupDivi
            ,groupCdNm
            ,groupCdExp
            ,groupOrder
            ,useYn
            ,inpId
            ,inpDttm
            ,updId
            ,updDttm
        )
        SELECT
            #{corpCd}
            ,(SELECT IFNULL(MAX(CAST(groupNo as signed)),0)+1 FROM TB_SYSTEM_SHA_LIST WHERE corpCd = #{corpCd})
            ,#{groupCd}
            ,#{groupDivi}
            ,#{groupCdNm}
            ,#{groupCdExp}
            ,#{groupOrder}
            ,#{useYn}
            ,#{userId}
            ,now()
            ,#{userId}
            ,now()
    </insert>

    <insert id="insertShaDet" parameterType="hashMap">
        INSERT INTO /* insertShaDet */
        TB_SYSTEM_SHA_DET(
             corpCd
            ,groupNo
            ,commCdNo
            ,commCd
            ,commCdNm
            ,commCdExp
            ,reserveVal1
            ,reserveVal2
            ,reserveVal3
            ,commCdOrder
            ,useYn
            ,inpId
            ,inpDttm
            ,updId
            ,updDttm
        )
        SELECT
            #{corpCd}
            ,#{groupNo}
            ,(SELECT IFNULL(MAX(commCdNo),0)+1 FROM TB_SYSTEM_SHA_DET)
            ,#{commCd}
            ,#{commCdNm}
            ,#{commCdExp}
            ,#{reserveVal1}
            ,#{reserveVal2}
            ,#{reserveVal3}
            ,#{commCdOrder}
            ,#{useYn}
            ,#{userId}
            ,now()
            ,#{userId}
            ,now()
    </insert>

    <update id="updateShaList" parameterType="hashMap">
        UPDATE /* updateShaList */
        TB_SYSTEM_SHA_LIST SET
            groupCd = #{groupCd}
            ,groupDivi = #{groupDivi}
            ,groupCdNm = #{groupCdNm}
            ,groupCdExp = #{groupCdExp}
            ,groupOrder = #{groupOrder}
            ,useYn = #{useYn}
            ,updId = #{userId}
            ,updDttm = now()
        WHERE corpCd = #{corpCd}
          AND groupNo = #{groupNo}
    </update>

    <update id="updateShaDet" parameterType="hashMap">
        UPDATE /* updateShaDet */
        TB_SYSTEM_SHA_DET SET
            commCd = #{commCd}
            ,commCdNm = #{commCdNm}
            ,commCdExp = #{commCdExp}
            ,reserveVal1 = #{reserveVal1}
            ,reserveVal2 = #{reserveVal2}
            ,reserveVal3 = #{reserveVal3}
            ,commCdOrder = #{commCdOrder}
            ,useYn = #{useYn}
            ,updId = #{userId}
            ,updDttm = now()
        WHERE corpCd = #{corpCd}
          AND groupNo = #{groupNo}
          AND commCdNo = #{commCdNo}
    </update>

    <delete id="deleteShaList"  parameterType="hashMap">
        DELETE /* deleteShaList */
        FROM TB_SYSTEM_SHA_LIST
        WHERE corpCd = #{corpCd}
          AND groupNo = #{groupNo}
    </delete>

    <delete id="deleteShaDet"  parameterType="hashMap">
        DELETE /* deleteShaDet */
        FROM TB_SYSTEM_SHA_DET
        WHERE corpCd = #{corpCd}
          AND groupNo = #{groupNo}
        <if test="commCdNo != null and !commCdNo.equals('')">
            AND commCdNo = #{commCdNo}
        </if>

    </delete>
</mapper>