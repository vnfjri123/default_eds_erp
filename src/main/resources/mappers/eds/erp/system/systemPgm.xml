<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.springboot.myapp.eds.erp.controller.system.systemPgmMapper">
    <select id="selectPmgMgtList"  resultType="com.springboot.myapp.eds.erp.vo.system.systemPgmListVO">
        SELECT /* selectPmgMgtList */
            corpCd
            ,pgmId
            ,pgmNm
            ,pgmUrl
            ,pgmExp
            ,useYn
        FROM TB_SYSTEM_PGM_LIST
        WHERE corpCd = #{corpCd}
        <if test="pgmNm != null and !pgmNm.equals('')">
            AND pgmNm like '%' #{pgmNm} '%'
        </if>
        <if test="pgmUrl != null and !pgmUrl.equals('')">
            AND pgmUrl like '%' #{pgmUrl} '%'
        </if>
        <if test="useYn != null and !useYn.equals('')">
            AND useYn = #{useYn}
        </if>
    </select>

    <select id="selectPmgMgtListPopup"  resultType="com.springboot.myapp.eds.erp.vo.system.systemPgmPopupVO">
        SELECT /* selectPmgMgtListPopup */
        corpCd
        ,pgmId
        ,pgmNm
        ,pgmUrl
        ,pgmExp
        ,useYn
        FROM TB_SYSTEM_PGM_LIST
        WHERE corpCd = #{corpCd}
        <if test="pgmNm != null and !pgmNm.equals('')">
            AND pgmNm like '%' #{pgmNm} '%'
        </if>
        <if test="pgmUrl != null and !pgmUrl.equals('')">
            AND pgmUrl like '%' #{pgmUrl} '%'
        </if>
        <if test="useYn != null and !useYn.equals('')">
            AND useYn = #{useYn}
        </if>
    </select>

    <insert id="insertPmgMgtList" parameterType="hashMap">
        INSERT INTO /* insertPmgMgtList */
            TB_SYSTEM_PGM_LIST(
                               corpCd
                              ,pgmId
                              ,pgmNm
                              ,pgmUrl
                              ,pgmExp
                              ,useYn
                              ,inpId
                              ,inpDttm
                              ,updId
                              ,updDttm
        )
        SELECT
            #{corpCd}
             ,(SELECT IFNULL(MAX(CAST(pgmId as signed)),0)+1 FROM TB_SYSTEM_PGM_LIST WHERE corpCd = #{corpCd})
             ,#{pgmNm}
             ,#{pgmUrl}
             ,#{pgmExp}
             ,#{useYn}
             ,#{userId}
             ,now()
             ,#{userId}
             ,now()
    </insert>

    <update id="updatePmgMgtList" parameterType="hashMap">
        UPDATE TB_SYSTEM_PGM_LIST/* updatePmgMgtList */
        SET pgmNm = #{pgmNm}
          ,pgmUrl = #{pgmUrl}
          ,pgmExp = #{pgmExp}
          ,useYn = #{useYn}
          ,updId = #{userId}
          ,updDttm = now()
        WHERE corpCd = #{corpCd}
          AND pgmId = #{pgmId}
    </update>

    <delete id="deletePmgMgtList"  parameterType="hashMap">
        DELETE /*deletePmgMgtList*/
        FROM TB_SYSTEM_PGM_LIST
        WHERE corpCd = #{corpCd}
          AND pgmId = #{pgmId}
    </delete>

    <select id="checkedMenuList"  resultType="com.springboot.myapp.eds.erp.vo.system.systemPgmDetVO">
        SELECT /* checkedMenuList */
            T1.menuNm
             ,(SELECT T0.pgmNm FROM TB_SYSTEM_PGM_LIST T0 WHERE T0.pgmId = #{pgmId}) pgmNm
             ,COUNT(T2.pgmId) cnt
        FROM TB_SYSTEM_MENU_LIST T1 INNER JOIN TB_SYSTEM_MENU_DET T2 ON T1.corpCd = T2.corpCd = T1.menuId = T2.menuId
        WHERE T1.corpCd = #{corpCd}
          AND T2.pgmId = #{pgmId}
        GROUP BY T1.corpCd, T1.menuId, T1.menuId
    </select>
</mapper>