<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.springboot.myapp.eds.groupware.controller.car.carLogMapper">

    <select id="selectCarLogList"  resultType="com.springboot.myapp.eds.groupware.vo.car.carLogListVO">
        SELECT /* selectCarLogList */
            corpCd
            ,(SELECT corpNm FROM TB_BASE_CORP_LIST T0 WHERE T0.corpCd=T1.corpCd) AS corpNm
            ,busiCd
            ,(SELECT busiNm FROM TB_BASE_BUSI_LIST T0 WHERE T0.corpCd=T1.corpCd AND T0.busiCd=T1.busiCd) AS busiNm
            ,carLogCd
            ,carCd
            ,(SELECT concat(carNo,' - ',carNm) FROM TB_BASE_CAR_LIST T0 WHERE T0.corpCd=T1.corpCd AND T0.carCd=T1.carCd) AS carNm
            ,stDt
            ,edDt
            ,stLoca
            ,edLoca
            ,purpCd
            ,empCd
            ,(SELECT empNm FROM TB_BASE_USER_LIST I1 WHERE I1.corpCd = #{corpCd} AND I1.empCd = T1.empCd) AS empNm
            ,depaCd
            ,(SELECT depaNm FROM TB_BASE_DEPA_LIST I1 WHERE I1.corpCd = #{corpCd} AND I1.depaCd = T1.depaCd) AS depaNm
            ,stDist
            ,mdDist
            ,edDist
            ,note
            ,T1.inpId
            ,(SELECT empNm FROM TB_BASE_USER_LIST I1 WHERE I1.corpCd = #{corpCd} AND I1.empCd = T1.inpId) AS inpNm
            ,T1.updId
            ,(SELECT empNm FROM TB_BASE_USER_LIST I1 WHERE I1.corpCd = #{corpCd} AND I1.empCd = T1.updId) AS updNm
        FROM TB_CAR_LOG_LIST T1
        WHERE T1.corpCd = #{corpCd}
        <if test="authDivi == '3' or authDivi.equals('3')">
            AND T1.depaCd = #{depaCd}
        </if>
        <if test="authDivi == '4' or authDivi.equals('4')">
            AND T1.depaCd = #{depaCd}
            AND T1.empCd = #{empCd}
        </if>
          AND (stDt BETWEEN #{stDt} AND #{edDt} OR edDt BETWEEN #{stDt} AND #{edDt})
        ORDER BY carlogcd*1 DESC
    </select>

    <insert id="insertCarLogList" parameterType="hashMap">
        INSERT INTO /* insertCarLogList */
        TB_CAR_LOG_LIST(
             corpCd
            ,carLogCd
            ,carCd
            ,stDt
            ,edDt
            ,stLoca
            ,edLoca
            ,empCd
            ,busiCd
            ,depaCd
            ,purpCd
            ,stDist
            ,mdDist
            ,edDist
            ,note
            ,inpId
            ,inpDttm
            ,updId
            ,updDttm)
        SELECT
            #{corpCd}
            ,(SELECT IFNULL(MAX(CAST(carLogCd as signed)),0)+1
              FROM TB_CAR_LOG_LIST
              WHERE corpCd = #{corpCd})
            ,#{carCd}
            ,#{stDt}
            ,#{edDt}
            ,#{stLoca}
            ,#{edLoca}
            ,#{empCd}
            ,#{busiCd}
            ,#{depaCd}
            ,#{purpCd}
            ,#{stDist}
            ,#{mdDist}
            ,#{edDist}
            ,#{note}
            ,#{userId}
            ,now()
            ,#{userId}
            ,now()
    </insert>

    <update id="updateCarLogList" parameterType="hashMap">
        UPDATE /* updateCarLogList */
            TB_CAR_LOG_LIST
        SET carCd = #{carCd}
           ,stDt = #{stDt}
           ,edDt = #{edDt}
           ,stLoca = #{stLoca}
           ,edLoca = #{edLoca}
           ,empCd = #{empCd}
           ,depaCd = #{depaCd}
           ,purpCd = #{purpCd}
           ,stDist = #{stDist}
           ,mdDist = #{mdDist}
           ,edDist = #{edDist}
           ,note = #{note}
           ,updId   = #{userId}
           ,updDttm = now()
        WHERE corpCd = #{corpCd}
        AND carLogCd = #{carLogCd}
    </update>

    <delete id="deleteCarLogList"  parameterType="hashMap">
        DELETE /* deleteCarLogList */
        FROM TB_CAR_LOG_LIST
        WHERE corpCd = #{corpCd}
          AND carLogCd = #{carLogCd}
    </delete>
</mapper>