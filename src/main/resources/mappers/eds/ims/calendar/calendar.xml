<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.springboot.myapp.eds.ims.controller.calendar.CalendarMapper">

    <select id="selectCalendar" resultType="com.springboot.myapp.eds.ims.vo.calendar.calendarVO">
        SELECT `index`,
               `corpCd`,
               `depaCd`,
               `title`,
               `content`,
               `startCalDt`,
               `endCalDt`,
               `empNm`,
               `inpDttm`,
               `updDttm`,
               `remark`
        FROM tb_ims_calendar
        WHERE corpCd = #{corpCd}
        ORDER BY `index`
    </select>

    <select id="selectCalendarOnPopup" resultType="com.springboot.myapp.eds.ims.vo.calendar.calendarVO">
        SELECT `index`,
               `corpCd`,
               `depaCd`,
               `title`,
               `content`,
               `startCalDt`,
               `endCalDt`,
               (SELECT empNm FROM TB_BASE_USER_LIST I1 WHERE I1.corpCd = #{corpCd} AND I1.empCd = T1.empNm) AS empNm,
               `inpDttm`,
               `updDttm`,
               `remark`
        FROM tb_ims_calendar T1
        WHERE `corpCd` = #{corpCd}
          AND `index` = #{index}
    </select>

    <insert id="insertCalendar"
            useGeneratedKeys="true"
            keyProperty="index"
            keyColumn="index"
            parameterType="hashMap">
        INSERT INTO tb_ims_calendar
        (corpCd,
         depaCd,
         title,
         content,
         startCalDt,
         endCalDt,
         empNm,
         inpDttm,
         updDttm,
         remark)
        SELECT #{corpCd},
               #{depaCd},
               #{title},
               #{content},
               #{startCalDt},
               #{endCalDt},
               #{empNm},
               now(),
               now(),
               #{remark}
    </insert>

    <update id="updateCalendar" parameterType="hashMap">
        UPDATE tb_ims_calendar
        SET `index`      = #{index},
            `depaCd`     = #{depaCd},
            `title`      = #{title},
            `content`    = #{content},
            `startCalDt` = #{startCalDt},
            `endCalDt`   = #{endCalDt},
            `updDttm`    = now(),
            `remark`     = #{remark},
            `updId`      = #{updId}
        WHERE `corpCd` = #{corpCd}
          AND `index` = #{index}
    </update>

    <delete id="deleteCalendar" parameterType="hashMap">
        DELETE
        FROM tb_ims_calendar
        WHERE `corpCd` = #{corpCd}
          AND `depaCd` = #{depaCd}
          AND `index` = #{index}
    </delete>

    <select id="selectTodayCalendar" resultType="com.springboot.myapp.eds.ims.vo.calendar.calendarVO">
        SELECT *
        FROM tb_ims_calendar
        WHERE startCalDt <![CDATA[<=]]> Date(NOW()) AND Date(NOW()) <![CDATA[<=]]> endCalDt;
    </select>

</mapper>